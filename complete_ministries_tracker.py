#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Complete Ministries Tracker
מעקב דפי שירות עם רשימה מלאה של כל המשרדים
"""

import requests
import csv
import time
from datetime import datetime
import argparse

class CompleteMinistriesTracker:
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Accept': 'application/json, text/plain, */*',
            'Accept-Language': 'he-IL,he;q=0.9,en;q=0.8',
        })
        
        # השפות לבדיקה
        self.languages = ['he', 'ar', 'en', 'es', 'fr', 'ru']
        self.language_names = {
            'he': 'עברית',
            'ar': 'ערבית', 
            'en': 'אנגלית',
            'es': 'ספרדית',
            'fr': 'צרפתית',
            'ru': 'רוסית'
        }
        
        # רשימה מלאה של כל המשרדים והיחידות (מהקובץ שלך)
        self.departments = [
            ("ba3bf87e-6a99-4e24-ae89-2815a450881e", "משרד הכלכלה והתעשייה"),
            ("63e7fa42-b4f5-4f28-bf80-6cae59ed55d9", "אגף א' לקידום אוכלוסיות הלהט\"ב"),
            ("e701525b-a29d-4b5c-befe-7a16eb25883b", "אגף ביטחון וחירום"),
            ("1635cfd9-dbc7-4016-bac4-df823f106bdd", "אגף בכיר אזרחים ותיקים"),
            ("f9a91cb0-1365-46f5-b238-b5f9945ee52d", "אגף בכיר לפיתוח כלכלי חברתי בחברה הבדואית בנגב"),
            ("ea0d4b20-fa34-4c7b-b739-ed25291e4e41", "אגף המפקח הכללי לענייני ביקורת המדינה"),
            ("019632ff-7e60-4dec-ad26-5a6fb810e34e", "אגף ממשל וחברה"),
            ("d1c39ee4-5b9c-4f4f-a195-7b30d22b11e3", "אגף עתודות לישראל"),
            ("e557eb8d-18dc-4ab6-8f5c-80cfd29caf11", "אגף שומת מקרקעין (השמאי הממשלתי)"),
            ("9218e4e7-f488-46f3-827f-15d225736e0e", "ארכיון המדינה"),
            ("95ce3cb2-30d2-4d38-b44b-a694bd7ba547", "בית הנשיא"),
            ("94a86de1-01ed-4a28-810c-c8baae1b0d0e", "בתי הדין הדתיים הדרוזיים בישראל"),
            ("727e39c5-a951-4cd5-9479-07de7f6b64d2", "בתי הדין הרבניים"),
            ("de021da5-b740-4f6d-a8b5-43e68ff5813d", "בתי הדין השרעיים"),
            ("4374079c-6952-4ccb-a70a-c97ec2132bbf", "בתי הדין לאוכלוסין והגירה"),
            ("924995f9-65f5-4bbd-a119-cfa6ee56bc7c", "בתי הדין לעבודה"),
            ("abe9fdf6-a1d7-4b5a-a44c-9fe561e135b0", "דורות - מרכז רפואי לשיקום וגריאטריה"),
            ("000346dc-a071-413b-8710-7e0da217b988", "האגף לאסדרת מקצועות (מנהלת היחידות המקצועיות)"),
            ("483b9cd7-ece1-45fb-bb39-42926fc1ca84", "האגף לרישוי כלי ירייה"),
            ("59a8638d-4c4c-477b-92f0-f545794acea1", "האפוטרופוס הכללי והממונה על ענייני ירושה"),
            ("1f67b022-687d-444f-8cd9-66845a5027a4", "האתר להנצחת רחבעם זאבי (גנדי)"),
            ("c5c40fcb-9993-45f3-b736-f437f96bb3f3", "האתר לזכויות נפגעות ונפגעי עבירה"),
            ("60fce28b-812a-43da-8e1f-22291f728172", "הוועדה להקמת המשמר הלאומי לישראל"),
            ("f4f07761-3f3f-4c06-ba92-a4f21bb04738", "החטיבה החברתית"),
            ("aca19f98-5dc7-4c3f-b34f-0e3056068e13", "היחידה הממשלתית לחופש המידע"),
            ("01dfa4c8-61a0-47e4-841d-9b90384646c0", "היחידה הממשלתית לתיאום המאבק בגזענות"),
            ("ca1e239f-a87b-4049-980c-543c0ef159c8", "היחידה לשיפור השירות הממשלתי לציבור"),
            ("9c59d294-c7b9-43b8-987a-9d7b575469ed", "היחידה לשיתופי פעולה רב מגזריים"),
            ("51155360-6a34-40c0-bde4-d7b0a90a6724", "המוסד לביטוח לאומי"),
            ("5d2cd416-7c3f-45d1-aee3-ab390393f348", "המועצה הלאומית לכלכלה"),
            ("e83b1b7c-9d17-42b0-9d65-43c41745cb77", "המועצה להנצחת זכרם ופועלם של נשיאי ישראל וראשי ממשלה"),
            ("d1641ce9-8a69-4470-9218-80fe76551921", "המטה הלאומי להגנה על ילדים ברשת"),
            ("d1805730-e0d6-4c15-8ff4-baf039c0c371", "המטה לביטחון לאומי"),
            ("9d8de85e-d7b8-4028-affe-59722a33236d", "המטה למלחמה בפשיעה בחברה הערבית"),
            ("af353387-005a-4e08-9398-87f62008aaa2", "המיזם הלאומי 265 - דיגיטל בשלטון המקומי"),
            ("67eb85da-e2b8-4f18-b4b0-1a40e49f3acd", "המינהל לחינוך התיישבותי פנימייתי ועליית הנוער"),
            ("e9d11dea-f737-496c-83fe-a7748ac8448d", "המכון הגיאולוגי לישראל"),
            ("7baef0d0-050b-44f4-8bc9-6a6bf4a9f750", "המכון להכשרה משפטית"),
            ("292f8223-b818-41df-a601-974f1517d712", "הממונה על הביקורת על מידע פלילי"),
            ("268aaf52-ffea-4801-86ed-0bf8cd5d2116", "הממונה על הליכי חדלות פירעון ושיקום כלכלי"),
            ("7c2567df-4f65-4df4-a672-d05af48612b6", "הממונה על העזרה המשפטית"),
            ("9a70bba3-457a-42b5-9225-8133bf9d2b49", "הממונה על נותני שירות עסקי"),
            ("a1db8292-6f30-4545-b391-7400a4aec3ea", "המנהל האזרחי ביהודה ושומרון"),
            ("7380f4c1-331d-40ed-af3e-41457d46eb9c", "המנהלת לפיתוח מפרץ חיפה במשרד ראש הממשלה"),
            ("583263d1-8487-41f2-b12a-3e44c2b37735", "המעבדה הלאומית לסייבר, בקרה תעשייתית, תשתיות ואנרגיה"),
            ("65c63a74-c9ff-4bfc-9de8-5dbd4c062cf2", "המערך לטקסים ולאירועים ממלכתיים"),
            ("ae58b549-df61-42d3-89b1-6e646715c0a7", "המרכז הגריאטרי ראשון לציון"),
            ("7cea944d-a644-4b94-b9e0-4cce71342c5d", "המרכז הקהילתי לבריאות הנפש יפו"),
            ("75d5de74-09f4-43ef-86e2-5adcc4e8b42f", "המרכז הרפואי בני ציון"),
            ("5f05fd4e-d589-4441-91cb-cf94f0cdcfee", "המרכז הרפואי זיו"),
            ("cb911f6a-ed61-42b9-9b98-8b5df96cfe16", "המרכז הרפואי לבריאות הנפש מזור"),
            ("251e0205-9c1c-472c-ad16-0310c47dad98", "המרכז הרפואי ע\"ש אדית וולפסון"),
            ("21a0364e-1572-49b6-bafd-2debd6c3df9c", "המרכז לבריאות הנפש - אברבנאל"),
            ("85695cfc-0ff1-44fa-82b3-d9c156386d96", "המרכז למחקר גרעיני שורק"),
            ("46db887d-ddff-478b-a87a-cb247bb49280", "המרכז למיפוי ישראל"),
            ("a4558f18-657b-450e-87c3-32d70f6e07b5", "המשרד לביטחון לאומי"),
            ("7807091f-2385-4915-b1cb-fd4db6d2c1cc", "המשרד להגנת הסביבה"),
            ("90fba09e-a331-4c19-a6d3-8301993f382e", "המשרד לשוויון חברתי וקידום מעמד האישה"),
            ("4f415ec8-cd6c-426a-adcc-342917abae72", "המשרד לשירותי דת"),
            ("7a18aa2e-a950-4805-8b99-b438ac4df473", "המשרד לשיתוף פעולה אזורי"),
            ("0377b6f4-2c9b-4977-a8ec-0da77b0fd3ea", "הנהלת בתי הדין הרבניים"),
            ("437d460e-4b84-4243-b498-bd82239048aa", "הסניגוריה הציבורית"),
            ("74a188f9-b723-4c8c-b97e-8eb7de0c5a2f", "הקמפוס הדיגיטלי של בית הספר לתיאום וקישור"),
            ("e39ee324-ba36-4e15-afd6-b4c13a5dc6bc", "הרבנות הראשית לישראל"),
            ("c7db667a-4697-48af-a432-70f213c4e74e", "הרשות הארצית לתחבורה ציבורית"),
            ("53321058-5a80-431e-ac67-969171fcc841", "הרשות הלאומית לבטיחות בדרכים"),
            ("3d4cb1ea-4299-4b8a-8288-48851b62bbc3", "הרשות הלאומית לביטחון קהילתי"),
            ("03919f7f-55f3-4846-a50b-4079735bf569", "הרשות הממשלתית להתחדשות עירונית"),
            ("b7f4cf74-9ceb-454d-a057-e9bdc1dcdae9", "הרשות השופטת"),
            ("530572ba-73c7-4861-8bfe-e5fb712c83d6", "הרשות לאיסור הלבנת הון ומימון טרור"),
            ("9777687c-d21b-4fe0-b8db-372e005cdfd1", "הרשות לאכיפה במקרקעין"),
            ("dd853d8a-5165-45f3-9640-f0046bdc9b76", "הרשות להגנה על עדים"),
            ("4aadba43-3d71-4e7c-a4fe-5bf47b723d4e", "הרשות להגנת הפרטיות"),
            ("927abd8f-4179-4bc9-927b-7178d326cbd1", "הרשות להגנת הצרכן ולסחר הוגן"),
            ("788cb851-92bd-460d-935d-dc304ff4c79d", "הרשות לזהות לאומית יהודית"),
            ("4c9c3099-b0e4-47f6-b593-28935df6289d", "הרשות לזכויות ניצולי השואה"),
            ("d0d64b0f-8b4e-4149-8685-54b32d80186d", "הרשות לפיתוח והתיישבות הבדואים בנגב"),
            ("f60d1f2a-ddf1-45c0-84a2-1c1164d6dba9", "הרשות לפיתוח כלכלי של מגזר המיעוטים"),
            ("94c9576f-f69e-4fcf-9274-3d705efd615f", "הרשות לפיתוח כלכלי-חברתי של המגזר החרדי"),
            ("c18a7c4d-df73-43cd-a59d-504ad68b5994", "הרשות לקידום מעמד האישה"),
            ("7f339ddd-6295-4025-8991-2c5a3ea2a76f", "הרשות לרישום והסדר זכויות מקרקעין"),
            ("98f81ba9-af4d-4b7e-93df-01ccdf025736", "הרשות לשיקום האסיר"),
            ("b7c564b6-41bd-4371-8ecf-8cda4e3099aa", "הרשות לתכנון ופיתוח ההתיישבות והכפר"),
            ("9cb6d2fa-cab2-47af-b7a1-1be79cb3173d", "השירות המטאורולוגי"),
            ("f5d85f14-2dde-43bc-a565-5c998faa4836", "התכנית הממשלתית לשילוב יוצאי אתיופיה"),
            ("9ad9b8a4-acaa-4cb3-910b-1bcf0b852322", "ועדת הבדיקה הממשלתית לאירוע בריחת האסירים הביטחוניים מבית סוהר גלבוע"),
            ("26857f24-4eaa-4032-a39d-5dc66d374ee3", "ועדת הבחירות המרכזית לכנסת"),
            ("3fa88577-d5c9-4da2-a104-dfc003254043", "ועדת הבחירות המרכזית לכנסת ה- 23"),
            ("74a3a304-6898-46c0-bbc3-140e02dfa856", "ועדת החקירה הממלכתית לעניין כלי השיט"),
            ("e2dda42b-0ad6-49be-a997-c207b490d81b", "ועדת המחירים"),
            ("4f9a783c-548c-430a-b047-2fd7a7e9972a", "ועדת הרוגלות"),
            ("005f611f-aaa3-4adf-9003-c30a8bc98df3", "ועדת השמות הממשלתית"),
            ("f62fc44f-1287-4e3b-9142-ffb1b70e1732", "ועדת חקירה ממלכתית - אסון מירון"),
            ("03f84303-ed13-445d-84c2-e198be456005", "ועדת ערר לענייני קורונה וחרבות ברזל – מסלול ארצי"),
            ("8a705253-c5fd-41f7-984b-0c57e90a8ce6", "חופש המידע"),
            ("63db92ca-11c9-448a-b36c-1084990322e2", "חנינות"),
            ("ba9f3048-d2da-452c-8e78-b569ed10c6e2", "חרבות ברזל - מידע לציבור ממשרדי הממשלה"),
            ("5d035cf2-da5b-497d-bd41-2a7e3ea2cf6c", "ייעוץ וחקיקה"),
            ("182e15d2-c8d7-403f-9f30-b3e4df8e5e68", "כבאות והצלה לישראל"),
            ("be3be8b2-3997-4c88-9441-2dcdf7ab7d54", "לשכת העיתונות הממשלתית"),
            ("a6220daf-0ab3-420d-92f0-58581b90b3e0", "מ.ה.ל.ב - מרכז השליטה למשפחות הנעדרים והחטופים"),
            ("caea8076-c7bf-4763-9874-788ddc19d2cb", "מגזין נקודת מבט"),
            ("0c2a6dd6-5bca-48d2-9759-c7be174296fa", "מגן דוד אדום בישראל"),
            ("07899167-3cf5-4df0-8076-bcecbfee654e", "מועצת רשות המים"),
            ("646c0727-7b0a-43df-ba17-030576fac3d5", "מוקד מענה ממשלתי מרכזי"),
            ("394045a2-fa40-4cd0-b50a-eede694611b0", "מורשת ישראל בהר הבית"),
            ("1bf4afc0-95a3-4f2b-8993-2f3db7216134", "מזכירות הממשלה"),
            ("51538cbb-494c-4da1-93f3-e52418139351", "מחלקת המחקר של הרשות השופטת"),
            ("c56e9681-ce7c-4d75-aa1e-75127fe0ded7", "מחלקת חנינות"),
            ("1c312527-6a7e-4af7-8fe6-22f4da333159", "מטה המיזם הלאומי ישראל דיגיטלית, במשרד לשוויון חברתי"),
            ("2574c957-2109-4270-9586-62ca2d37857e", "מינהל התכנון"),
            ("7081db9d-0090-4d60-b129-b492b9f5f6eb", "מנהלת תחבורה חכמה במשרד ראש הממשלה"),
            ("a8d3ea59-df3b-4dd6-acd9-26c09079570b", "מענקים והטבות לתעשיינים"),
            ("7e3f29d6-998e-46d0-91ca-ccefc673fcfc", "מערך הגיור"),
            ("81118354-e792-4e08-9057-f7ae5200cbf9", "מערך הדיגיטל הלאומי"),
            ("4bcc13f5-fed6-4b8c-b8ee-7bf4a6bc81c8", "מערך הסייבר הלאומי"),
            ("c2185409-df16-49c4-911d-34f718bb7929", "מערכת ההזדהות הלאומית"),
            ("ea0ef5ea-c465-4ead-811e-4c8e59e40be5", "מערכת תמר (תכנון ממשלתי רוחבי) – חומרי עזר"),
            ("8098245a-163b-4fbe-88e9-f57e11532d8f", "מרחבים – המרכז הרפואי לטיפול במוח ובנפש, באר יעקב נס ציונה"),
            ("4153ab18-52bb-42dc-a347-b513faa428ca", "מרכז המידע והידע הלאומי למערכה בקורונה"),
            ("ca300f4a-d232-43bc-ac7e-6bde735403d2", "מרכז רפואי פלימן"),
            ("2042b1a4-5ec1-44a9-84dc-764b19864cfa", "משטרת ישראל"),
            ("f41159c1-7867-41c3-bc0a-cbfe0da1bb1a", "משרד האוצר"),
            ("0caee7eb-1ebb-4c12-9ed8-7dce94badcb2", "משרד האנרגיה והתשתיות"),
            ("7566b0f1-c9a4-4af7-ab01-d34ca3a52104", "משרד הביטחון"),
            ("c515b1b2-3163-499e-bdbd-8849147c5ada", "משרד הבינוי והשיכון"),
            ("104cb0f4-d65a-4692-b590-94af928c19c0", "משרד הבריאות"),
            ("75b82171-30fd-4b5b-84a6-3fcb827506a6", "משרד הדיגיטל הלאומי"),
            ("39c1fee9-74d5-4091-a5c0-8c921676c992", "משרד ההסברה"),
            ("389346b9-e5ec-46a7-abde-102bee0945b4", "משרד ההשכלה הגבוהה והמשלימה"),
            ("0fc59189-491d-45c5-9992-0fcc067fd509", "משרד ההתיישבות והמשימות הלאומיות"),
            ("75d0cbd7-46cf-487b-930c-2e7b12d7f846", "משרד החדשנות, המדע והטכנולוגיה"),
            ("6cbf57de-3976-484a-8666-995ca17899ec", "משרד החוץ"),
            ("3a4dfc8a-ac31-4ab4-8734-35090ae3bb06", "משרד החינוך"),
            ("920e5116-ca8b-4bb5-b54c-6a518d3d94b9", "משרד החקלאות וביטחון המזון"),
            ("5c7214c6-6571-43b1-9474-a0541e7afd94", "משרד המודיעין"),
            ("6ade9ef2-44fb-416b-a430-0e9475933ad8", "משרד המורשת"),
            ("86842de6-987b-42d4-b9c2-cbd7d0619534", "משרד המשפטים"),
            ("1f628453-da79-4549-8c12-1073a718c9b0", "משרד הנגב, הגליל והחוסן הלאומי"),
            ("85d16bf0-1c3e-486a-97cd-2b07d89e6934", "משרד העבודה"),
            ("27db3169-ab0e-490c-af70-6d03133cb1f3", "משרד העלייה והקליטה"),
            ("bbdbfb50-7ef3-4e3b-9718-f40f011283c6", "משרד הפנים"),
            ("4fa63b79-3d73-4a66-b3f5-ff385dd31cc7", "משרד הרווחה והביטחון החברתי"),
            ("48eaee91-0c97-4ef3-b364-50ae52e3b56f", "משרד התחבורה והבטיחות בדרכים"),
            ("d6b46ce2-975b-43ee-afbd-404ba29b01e8", "משרד התיירות"),
            ("1213ca14-4263-4720-b7bf-afa8e8c05444", "משרד התפוצות והמאבק באנטישמיות"),
            ("503be068-3051-4dc0-bc61-65f0b33f0570", "משרד התקשורת"),
            ("7d5d01a1-c043-4c87-b8ef-5061999e797c", "משרד התרבות והספורט"),
            ("1a053147-b15c-436e-b057-d3b8ee050eb8", "משרד ירושלים ומסורת ישראל"),
            ("a9e7fc28-9bce-42cd-9c58-01a8591f08df", "משרד משאבי המים"),
            ("e744bba9-d17e-429f-abc3-50f7a8a55667", "משרד ראש הממשלה"),
            ("4cd935d1-d6ec-4336-8ae1-d337c8c82d05", "משרד ראש הממשלה, \"נתיב\""),
            ("5f766f7f-0864-4387-be3b-899ea97d69c8", "נימבוס Cloud Me In"),
            ("9a6c04df-2d47-4764-9139-37f085b5965c", "נציבות שוויון זכויות לאנשים עם מוגבלות"),
            ("bfe22d82-2309-43ff-94d7-1eeb873ab368", "נציבות שירות המדינה"),
            ("28222f50-52bd-4fd1-8800-6a39d7b13c6b", "נציבות תלונות הציבור על מייצגי המדינה בערכאות (נתם)\""),
            ("bd9833d0-469e-4db5-a09c-08642b44fb22", "נציבות תלונות הציבור על שופטים"),
            ("e8330bd2-d0d4-41fd-a4c6-6d57fef58a6d", "נתנו חיים – אתר להנצחת תורמי איברים"),
            ("a1fc9212-7c88-4029-b749-97fbf3a6fd85", "סיוע משפטי"),
            ("2cc21633-4d80-40bb-9733-b7c70dfeb07f", "על-הקו"),
            ("18c1d592-7526-4026-a295-38e3d47538e2", "פורטל ממשלתי - מבצע \"עם כלביא\""),
            ("c3279401-77b2-4d0b-9598-940fbb55c049", "פרקליטות המדינה"),
            ("2c50a510-1668-4226-9ba3-bb71b1962d85", "רשומות"),
            ("95b283ad-fc02-40e6-ac6f-8986acac6b86", "רשות האוכלוסין וההגירה"),
            ("c673e628-43e7-40e5-9610-19b2ffabce3b", "רשות האכיפה והגבייה"),
            ("c70a663b-34fd-4c56-8911-57e5f2d7ad8f", "רשות האסדרה"),
            ("b383f304-38b6-4112-b4a8-1253800d8702", "רשות החברות הממשלתיות"),
            ("c1d2ec1c-7f78-4d96-a739-1ed90f9e2b4b", "רשות החשמל"),
            ("854325f0-0e0b-4531-833d-ae72b3e43a28", "רשות המאגר הביומטרי הלאומי"),
            ("e9952141-a088-4a16-bf28-cd0255126ebe", "רשות המטרו"),
            ("d226daa2-e5c0-4595-b0d1-fe8e52110032", "רשות המים"),
            ("c0d8ba69-e309-4fe5-801f-855971774a90", "רשות המסים בישראל"),
            ("4b7bb398-52f7-45a1-8722-6cec1bd45733", "רשות הספנות והנמלים"),
            ("4ce56f25-7d6d-4f2c-991a-2e87d984494d", "רשות הפטנטים"),
            ("5973c473-0eef-429c-98be-bb85a0534c7c", "רשות הצעירים"),
            ("1195ce53-2541-4214-8ad1-72d5273b4626", "רשות השירות הלאומי-אזרחי"),
            ("8b4e2a06-8ce1-4703-8895-c35be965ef1f", "רשות התאגידים"),
            ("51752c15-473a-4c15-959f-e719cb113529", "רשות התחרות"),
            ("1b2155ee-aceb-477f-93bc-9b03af86782e", "רשות התעופה האזרחית"),
            ("806561c8-659a-4fbb-9b8f-8ecc1e6b8164", "רשות מקרקעי ישראל"),
            ("809fb74a-67c7-4c4b-a8ad-86dd24786117", "רשות שוק ההון, ביטוח וחיסכון"),
            ("c8f3032c-34e6-44f6-88f7-8098122456f9", "רשם הזוגיות והיחידה לענייני עדות דתיות"),
            ("3e786d06-1b9d-4db1-abc5-ceef72e5132e", "שותפויות רב מגזריות ושיתוף ציבור"),
            ("c3f24c3b-9940-45c2-82a1-c4be2087bf99", "שירות בתי הסוהר"),
            ("74cf2e77-97f0-4a0e-8874-4166450059df", "שירות התעסוקה הישראלי"),
            ("0e349524-943c-4fd5-a99c-4e3e6556c6e6", "שיתוף ציבור"),
            ("bbb9e22c-cdf6-434e-bdfb-40d8c26be29d", "תוכנית לאומית למניעת אובדנות"),
            ("8f505fb3-cfb2-4745-b02c-36f50212f2e8", "תיאום המאבק בסחר בבני אדם"),
            ("f79320cc-188a-43ed-84f2-6b60fe464ad4", "תיאום פעולות הממשלה בשטחים"),
            ("a44d7eeb-c006-4db7-96a6-cf619fd06eae", "תעופה בזמן קורונה")
        ]

    def get_services_count(self, dept_id: str, language: str) -> int:
        """קבלת מספר דפי השירותים עבור משרד בשפה מסוימת"""
        
        url = f"https://www.gov.il/{language}/api/GeneralApi/GetModel"
        params = {
            'ModelName': 'Service',
            'OfficeTaxonomy': dept_id,
            'PageSize': 1,
            'PageNumber': 1
        }
        
        try:
            response = self.session.get(url, params=params, timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                return data.get('totalResults', 0)
                
        except Exception:
            pass
            
        return 0

    def scan_department(self, dept_id: str, dept_name: str) -> dict:
        """סריקת משרד יחיד"""
        
        measurement_date = datetime.now().strftime("%B %d, %Y")
        
        dept_data = {
            'תאריך_מדידה': measurement_date,
            'שם_המשרד': dept_name,
            'מזהה_משרד': dept_id
        }
        
        total_services = 0
        
        for lang in self.languages:
            count = self.get_services_count(dept_id, lang)
            dept_data[self.language_names[lang]] = count
            total_services += count
            time.sleep(0.1)
        
        dept_data['סה_כ'] = total_services
        return dept_data

    def scan_all(self, sample_size: int = None) -> list:
        """סריקת כל המשרדים"""
        
        departments_to_scan = self.departments
        
        if sample_size:
            departments_to_scan = departments_to_scan[:sample_size]
            print(f"🎯 בודק דגימה של {sample_size} משרדים")
        else:
            print(f"🔍 בודק את כל {len(departments_to_scan)} המשרדים")
            
        print("-" * 60)
        
        results = []
        
        for i, (dept_id, dept_name) in enumerate(departments_to_scan, 1):
            print(f"[{i:3}/{len(departments_to_scan)}] {dept_name[:45]}...")
            
            dept_data = self.scan_department(dept_id, dept_name)
            results.append(dept_data)
            
            if dept_data['סה_כ'] > 0:
                lang_summary = []
                for lang_name in self.language_names.values():
                    count = dept_data[lang_name]
                    if count > 0:
                        lang_summary.append(f"{lang_name[:2]}: {count}")
                
                print(f"    ✅ {dept_data['סה_כ']} דפים ({', '.join(lang_summary)})")
            else:
                print(f"    ❌ אין שירותים")
        
        return results

    def save_to_csv(self, results: list, filename: str = None) -> str:
        """שמירת התוצאות ל-CSV"""
        
        if not filename:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M")
            filename = f"govil_complete_{timestamp}.csv"
        
        fieldnames = [
            'תאריך_מדידה', 'שם_המשרד', 'עברית', 'ערבית', 
            'אנגלית', 'ספרדית', 'צרפתית', 'רוסית', 'סה_כ', 'מזהה_משרד'
        ]
        
        results.sort(key=lambda x: x['סה_כ'], reverse=True)
        
        with open(filename, 'w', newline='', encoding='utf-8-sig') as csvfile:
            writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
            writer.writeheader()
            writer.writerows(results)
        
        print(f"💾 נשמר: {filename}")
        return filename

    def print_summary(self, results: list):
        """הדפסת סיכום"""
        
        results_with_services = [r for r in results if r['סה_כ'] > 0]
        total_services = sum(r['סה_כ'] for r in results_with_services)
        
        print("\n" + "="*60)
        print("📊 סיכום")
        print("="*60)
        print(f"סה\"ך נבדקו: {len(results)} משרדים")
        print(f"עם שירותים: {len(results_with_services)} משרדים")
        print(f"סה\"ך דפי שירות: {total_services:,}")
        
        if total_services > 0:
            print("\nלפי שפות:")
            for lang_name in self.language_names.values():
                lang_total = sum(r[lang_name] for r in results_with_services)
                percentage = (lang_total / total_services * 100) if total_services > 0 else 0
                print(f"  {lang_name}: {lang_total:,} ({percentage:.1f}%)")
            
            print("\nמשרדים מובילים:")
            for i, r in enumerate(results_with_services[:10], 1):
                print(f"{i:2}. {r['שם_המשרד']}: {r['סה_כ']} דפים")

def main():
    parser = argparse.ArgumentParser(description="מעקב דפי שירות - כל המשרדים")
    parser.add_argument("--output", "-o", help="קובץ CSV פלט")
    parser.add_argument("--sample", type=int, help="דגימה של N משרדים")
    parser.add_argument("--quiet", "-q", action="store_true", help="פחות פלט")
    
    args = parser.parse_args()
    
    tracker = CompleteMinistriesTracker()
    
    try:
        print("🚀 מעקב דפי שירות - כל המשרדים הממשלתיים")
        print(f"⏰ {datetime.now().strftime('%d/%m/%Y %H:%M')}")
        print(f"📋 {len(tracker.departments)} משרדים ויחידות ברשימה")
        print()
        
        results = tracker.scan_all(args.sample)
        
        if results:
            csv_file = tracker.save_to_csv(results, args.output)
            
            if not args.quiet:
                tracker.print_summary(results)
            
            print(f"\n✅ הושלם! קובץ: {csv_file}")
            
        else:
            print("❌ אין תוצאות")
            
    except KeyboardInterrupt:
        print("\n❌ הופסק על ידי המשתמש")
    except Exception as e:
        print(f"❌ שגיאה: {e}")

if __name__ == "__main__":
    main()
